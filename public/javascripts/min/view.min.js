var viewPage={getToteGridHTML:function(e,t){"undefined"!=typeof e[0]&&(e=e[0]);var o=e._id,a=_.findWhere(browse.toteBags,{_id:o});if("undefined"==typeof a){var r={bags:[e]};$.get("/templates/_bag.html",function(e){var o=Handlebars.compile(e),a=o(r),i=$("<div />",{"class":"tote-grid-element view "+r.bags[0].color,"data-id":r.bags[0]._id,html:a});t(i,-1)})}else{var i=_.indexOf(browse.toteBags,a),n=$(".browse-tote-wrap .tote-grid-element").eq(i),s=$("<div />",{"class":n.attr("class")+" view","data-id":o,html:n.html()});t(s,i)}},nextTote:function(){var e=$(".view-carousel-wrap"),t=e.find(".tote-grid-element").outerWidth(),o=$(".view-carousel .tote-grid-element:last-child").attr("data-id"),a="/data/"+browse.currSort+"/"+o+"/next";$.getJSON(a,function(a){viewPage.getToteGridHTML(a,function(a,r){var i=_.findWhere(browse.toteBags,{_id:o});-1===r&&"undefined"!=typeof i&&browse.loadMoreBags(),TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"-10deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"10deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(e,.5,{x:-t,ease:cssBezier,onComplete:function(){e.append(a),e.find(".tote-grid-element:first-child").remove(),TweenLite.to(e,0,{x:0}),e.parents(".view-carousel").attr("data-display",o),window.history.pushState("html","Title","/totes/"+o),site.refreshTypeOnTotes(),$(".view-carousel-wrap .tote-grid-element .tote-shadow").css("opacity","1"),$(".view-controls .heart-outer-wrap").attr("class","heart-outer-wrap "+i.color),viewPage.updateLikes(),bagObject.upViewCount(o)}})})})},prevTote:function(){var e=$(".view-carousel-wrap"),t=e.find(".tote-grid-element").outerWidth(),o=$(".view-carousel .tote-grid-element:first-child").attr("data-id"),a="/data/"+browse.currSort+"/"+o+"/prev";$.getJSON(a,function(a){viewPage.getToteGridHTML(a,function(a){var r=_.findWhere(browse.toteBags,{_id:o});TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"10deg",ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .actual-tote",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"-10deg",scaleX:.9,ease:gridBagBezier,onComplete:function(){TweenLite.to(".view-carousel .tote-grid-element .tote-shadow",.3,{rotation:"0deg",ease:gridBagBezier})}}),TweenLite.to(e,.5,{x:t,ease:cssBezier,onComplete:function(){e.prepend(a),e.find(".tote-grid-element:last-child").remove(),TweenLite.to(e,0,{x:0}),e.parents(".view-carousel").attr("data-display",o),window.history.pushState("html","Title","/totes/"+o),site.refreshTypeOnTotes(),$(".view-carousel-wrap .tote-grid-element .tote-shadow").css("opacity","1"),$(".view-controls .heart-outer-wrap").attr("class","heart-outer-wrap "+r.color),viewPage.updateLikes(),bagObject.upViewCount(o)}})})})},updateLikes:function(){var e=$(".view-carousel").attr("data-display");likes.indexOf(e)>-1&&!$(".view-controls .heart-outer-wrap").hasClass("favorited")?likes.favorite($(".view-controls .heart-outer-wrap")):-1===likes.indexOf(e)&&$(".view-controls .heart-outer-wrap").hasClass("favorited")&&likes.unfavorite($(".view-controls .heart-outer-wrap"))}};$(document).ready(function(){$(document).hammer().on("tap",".view-controls button.left",function(){viewPage.prevTote()}),$(document).hammer().on("tap",".view-controls button.right",function(){viewPage.nextTote()}),$(document).hammer().on("tap, release",".view-carousel.on button.close",function(e){e.preventDefault(),e.stopPropagation(),browse.viewZoomOut()}),$(document).on("keyup",function(e){if($(".view-carousel").hasClass("on"))if(39===e.keyCode)viewPage.nextTote();else if(37===e.keyCode)viewPage.prevTote();else if(38===e.keyCode){var t=$(".view-carousel-wrap").scrollTop();$(".view-carousel-wrap").scrollTop(t-10)}else if(40===e.keyCode){var t=$(".view-carousel-wrap").scrollTop();$(".view-carousel-wrap").scrollTop(t+10)}}),$(document).hammer().on("drag",".view-carousel-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=e.gesture.direction;("left"===t||"right"===t)&&TweenLite.to($(this),0,{x:e.gesture.deltaX})}),$(document).hammer().on("dragend",".view-carousel-wrap",function(e){e.preventDefault(),e.stopPropagation();var t=e.gesture.direction;"left"===t?viewPage.nextTote():"right"===t&&viewPage.prevTote()})});