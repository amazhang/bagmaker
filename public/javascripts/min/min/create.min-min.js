var newBag;$(document).ready(function(){function e(e){var t=e.parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{_id:t.attr("data-id")});if(e.parent().hasClass("size")){var i=e.val();t.css("font-size",i+"em"),a.fontSize=Number(i)}else if(e.parent().hasClass("kerning")){var n=e.val();t.css("letter-spacing",n+"em"),a.kerning=Number(n)}else if(e.parent().hasClass("leading")){var s=e.val();t.css("line-height",s+"em"),a.leading=Number(s)}newBag.updateTextAreaSize(t.find("textarea"))}newBag=_.extend({},bagObject),newBag.data.editMode=!0,newBag.newTextField(),newBag.draw($(".content.create-page .bag-wrap"),function(){$(".editable-field").eq(0).addClass("selected"),$(".editable-field").eq(0).find("textarea").focus(),setTimeout(function(){var e=$(document).height()-$(window).height();$("body").animate({scrollTop:e},"slow")},100)}),$(document).hammer().on("tap",".bag-size-wrap .icon",function(e){e.preventDefault(),e.stopPropagation(),newBag.toggleSize($(this).hasClass("small-bag")?"small":"big"),$(this).siblings(".sel").removeClass("sel"),$(this).addClass("sel")}),$(document).hammer().on("tap",".addTextfield:not(.disabled)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.new").length>0?($(".editable-field").removeClass("selected"),setTimeout(function(){$(".editable-field.new").eq(0).addClass("selected")},100)):(newBag.newTextField(),newBag.draw())}),$(document).hammer().on("tap",".editable-field .corner.tr",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field").attr("data-id");newBag.deleteTextField(t)}),$(document).on("keyup",".editable-field textarea",function(){newBag.updateTextAreaSize($(this))}),$(document).hammer().on("tap",".editable-field",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field").removeClass("selected"),$(this).addClass("selected")}),$(document).hammer().on("tap",":not(.editable-field, .editable-field *)",function(e){e.preventDefault(),e.stopPropagation(),$(".editable-field.selected").removeClass("selected")}),$(document).hammer().on("tap",".text-controls .justification > *",function(e){e.preventDefault(),e.stopPropagation();var t=$(this).parents(".editable-field"),a=_.findWhere(newBag.data.textfields,{_id:t.attr("data-id")});$(this).siblings(".sel").removeClass("sel");var i=$(this).attr("class").split("-")[1];a.justify=i,$(this).parents(".editable-field").css("text-align",i),$(this).addClass("sel")}),$(document).on("input",".type-control input",function(){e($(this))}),$(document).on("change",".type-control input",function(){e($(this))}),$(document).hammer().on("drag",".editable-field",function(e){if(1!==$(e.target).parents(".text-controls").length&&("up"===e.gesture.direction||"down"===e.gesture.direction)){var t=e.gesture.deltaY,a=$(this).attr("data-id"),i=parseInt($(this).parents(".bag-body").css("font-size")),n=_.findWhere(newBag.data.textfields,{_id:a}),s=n.y*i,d=t+s;0>d?d=0:d+$(this).height()>$(this).parents(".textfields-wrap").height()&&(d=$(this).parents(".textfields-wrap").height()-$(this).height()),TweenLite.to($(this),0,{y:d+"px"})}}),$(document).hammer().on("dragend",".editable-field",function(e){if(1!==$(e.target).parents(".text-controls").length&&("up"===e.gesture.direction||"down"===e.gesture.direction)){var t=e.gesture.deltaY,a=$(this).attr("data-id"),i=parseInt($(this).parents(".bag-body").css("font-size")),n=_.findWhere(newBag.data.textfields,{_id:a}),s=n.y*i,d=t+s;0>d?d=0:d+$(this).height()>$(this).parents(".textfields-wrap").height()&&(d=$(this).parents(".textfields-wrap").height()-$(this).height()),n.y=d/i}}),$(document).hammer().on("tap","nav .right-actions .save",function(){newBag.saveAs()})});