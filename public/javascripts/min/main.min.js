function resizeHelper(){site.refreshTypeOnTotes(),setTimeout(function(){site.refreshTypeOnTotes()},1e3),"sml"!==site.breakpt()?TweenLite.to("nav",0,{y:0}):scrollHelper()}function scrollHelper(){var e=$("body").scrollTop();if($(".content").hasClass("browse-page")){var t=$(document).height()-$(window).height()-e;t<$(".browse-tote-wrap .tote-grid-element").outerHeight()&&browse.loadMoreBags()}}var cssBezier=new Ease(BezierEasing(.7,0,.3,1)),gridBagBezier=new Ease(BezierEasing(.42,0,.58,1));!function(e,t,i,n,a,s,r){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,s=t.createElement(i),r=t.getElementsByTagName(i)[0],s.async=1,s.src=n,r.parentNode.insertBefore(s,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-58975311-1","auto");var likes={userLikes:[],fetchUserLikes:function(){var e=$.cookie("likes");likes.userLikes=e.split(",");var t=likes.userLikes.indexOf("");-1!==t&&likes.userLikes.splice(t,1),$.cookie("likes",likes.userLikes.toString(),{expires:30})},likeBag:function(e){if(likes.indexOf(e)>-1)return!1;if(likes.userLikes.push(e),$.cookie("likes",likes.userLikes.toString(),{expires:30}),$(".view-carousel").hasClass("on")){var t=parseInt($(".view-carousel").attr("data-index"));likes.favorite($(".browse-tote-wrap .tote-grid-element").eq(t).find(".heart-outer-wrap"))}browse.getToteObj(e,function(t){t.likes=parseInt(t.likes)+1;var i=_.extend({},t);delete i._id,delete i.swingTimer,delete i.stopTimer,$.ajax({type:"PUT",data:JSON.stringify(i),url:"/totes/updatetote/"+e,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){}).fail(function(){})})},unlikeBag:function(e){var t=likes.indexOf(e);if(!(t>-1))return!1;if(likes.userLikes.splice(t,1),$.cookie("likes",likes.userLikes.toString(),{expires:30}),$(".view-carousel").hasClass("on")){var t=parseInt($(".view-carousel").attr("data-index"));likes.unfavorite($(".browse-tote-wrap .tote-grid-element").eq(t).find(".heart-outer-wrap"))}browse.getToteObj(e,function(t){t.likes=parseInt(t.likes)-1;var i=_.extend({},t);delete i._id,delete i.swingTimer,delete i.stopTimer,$.ajax({type:"PUT",data:JSON.stringify(i),url:"/totes/updatetote/"+e,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){}).fail(function(){})})},indexOf:function(e){return likes.userLikes.indexOf(e)},toggleLike:function(e){likes.indexOf(e)>-1?likes.unlikeBag(e):likes.likeBag(e)},favorite:function(e){e.addClass("favorited")},unfavorite:function(e){e.removeClass("favorited")}},site={colors:["black","white","red"],validTextfieldRegex:/\S+/,chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split(""),randomString:function(e){for(var t="",i=0;e>i;i++)t+=site.chars[Math.floor(Math.random()*site.chars.length)];return t},breakpts:{sml:650,med:960,lrg:1440},transistionEnd:"webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",breakpt:function(){var e=window.innerWidth,t="lrg";for(var i in site.breakpts)if(site.breakpts[i]>=e){t=i;break}return t},isTouch:function(){return!!("ontouchstart"in window)},textToHTML:function(e){return e=e.replace(/[<]/g,"&lt;").replace(/[>]/g,"&gt;").replace(/\n/g,"<br/>").replace(/[ ]{2}/g," &nbsp;")},htmlToText:function(e){return e=e.replace(/(&lt;)/g,"<").replace(/(&gt;)/g,">").replace(/(<br\/>)/g,"<br/>").replace(/( &nbsp;){2}/g,"  ")},refreshTypeOnTotes:function(){_.each($(".actual-tote"),function(e){var t=$(e).find(".bag-body").width(),i=t/2;if($(e).find(".bag-body").css("font-size",i+"px"),$(e).find(".bag-bottom").css("font-size",i+"px"),$(e).find(".editable-field").length>0)for(var n=$(e).find(".textfields-wrap .editable-field"),a=0;a<n.length;a++)bagObject.updateTextAreaSize($(n[a]).find("textarea"));if($(e).find(".text").length>0)for(var s=$(e).find(".textfields-wrap .text"),r=0;r<s.length;r++){var o=Number($(s[r]).attr("data-x"))*i,l=Number($(s[r]).attr("data-y"))*i;TweenLite.to(s[r],0,{x:o,y:l})}})},getTransformValue:function(e,t){var i=e.css("transform").replace(/[^0-9\-.,]/g,"").split(","),n=i[12]||i[4],a=i[13]||i[5];return void 0===n&&(n=0),void 0===a&&(a=0),"x"===t?n:"y"===t?a:void 0},render:function(e,t,i,n){$.get("/templates/_"+t+".html",function(t){Handlebars.registerHelper("textToHTML",function(e){return site.textToHTML(e)});var a=Handlebars.compile(t),s=a(e);$(i).html(s),"undefined"!=typeof n&&n()})},breakpts:{sml:640,med:940,lrg:1280},breakpt:function(){var e=window.innerWidth,t="lrg";for(var i in site.breakpts)if(site.breakpts[i]>=e){t=i;break}return t}},bagObject={data:{textfields:[],size:"small",color:"black",likes:0,views:0,editMode:!1},htmlElement:null,parent:null,refreshType:function(){var e=this.htmlElement,t=e.find(".bag-body").width(),i=t/2;e.find(".bag-body").css("font-size",i+"px"),e.find(".bag-bottom").css("font-size",i+"px"),setTimeout(function(){site.refreshTypeOnTotes()},100)},upViewCount:function(e){var t="/data/latest/tote/"+e;ga("send","pageview");var i;$.getJSON(t,function(t){i=t,i.views="number"!=typeof i.views||null===i.views?1:i.views+1;var n=_.extend({},i);delete n._id,$.ajax({type:"PUT",data:JSON.stringify(n),url:"/totes/updatetote/"+e,contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){}).fail(function(){})})},toggleSize:function(e){var t=this;"big"===e||"small"===t.data.size&&"undefined"==typeof e?(t.data.size="big",t.htmlElement.removeClass("small").addClass("big")):("small"===e||"big"===t.data.size&&"undefined"==typeof e)&&(t.data.size="small",t.htmlElement.removeClass("big").addClass("small")),setTimeout(function(){t.refreshType()},300)},changeColor:function(e){var t=this;_.contains(site.colors,e)&&($(t.htmlElement).attr("class","tote-wrap "+e+" "+t.data.size),t.data.color=e)},updateTextAreaSize:function(e){var t=this,i=e.parents(".editable-field"),n=i.attr("id"),a=e.siblings(".clone-text-wrap").find(".clone-text"),s=e.val();if($("button.save").removeClass("disabled"),$(".clone-text-wrap").removeClass("invisible"),""!==s&&site.validTextfieldRegex.test(s)){var r=site.textToHTML(s);a.html(r)}else $("button.save").addClass("disabled"),$(".clone-text-wrap").addClass("invisible"),""===s&&a.html("Type something.");for(;""!==s&&a.height()>a.parents(".textfields-wrap").height();)s=s.substr(0,s.length-1),r=site.textToHTML(s),a.html(r),a.height()<a.parents(".textfields-wrap").height()&&e.val(s);if(t.data&&t.data.textfields){var o=_.findWhere(t.data.textfields,{domid:n});o.text=s,""===e.val()?i.addClass("new"):i.removeClass("new");var l=parseInt(i.parents(".bag-body").css("font-size")),d=o.x*l,f=o.y*l;TweenLite.to(i,0,{x:d,y:f})}TweenLite.to(i,.1,{height:a.height()})},draw:function(e,t){var i=this;if("undefined"==typeof e&&null!==i.parent)e=$(i.parent);else{if(null===i.parent&&"undefined"==typeof e)return void console.log("you done fucked up");null===i.parent&&"undefined"!=typeof e&&(i.parent=e)}var n={bags:[i.data]};site.render(n,"bag",i.parent,function(){i.htmlElement=i.parent.find(".tote-wrap"),site.refreshTypeOnTotes(),"undefined"!=typeof t&&t()})},newTextField:function(){for(var e={y:0,x:0,width:"100%",justify:"left",fontSize:.28,kerning:-.03,leading:1},t=site.randomString(16);"undefined"!=typeof _.findWhere(this.data.textfields,{domid:t});)t=site.randomString(16);e.domid=t,this.data.textfields.push(e),this.data.textfields.length>=4&&$(".addTextfield").addClass("disabled")},deleteTextField:function(e,t){var i=this,n=$(this.htmlElement).find(".editable-field#"+e);TweenLite.to(n,.3,{scale:1.15,alpha:0,onComplete:function(){n.remove(),i.data.textfields=_.reject(i.data.textfields,function(t){return t.domid===e}),i.data.textfields.length<4&&$(".addTextfield").removeClass("disabled"),"undefined"!=typeof t&&t()}})},saveAs:function(){if(!(0===this.data.textfields.length||this.data.textfields.length>4)){for(var e=0;e<this.data.textfields.length;e++)if(!site.validTextfieldRegex.test(this.data.textfields[e].text))return;var t=_.extend({},this.data);delete t.editMode,t.timestamp=Math.round((new Date).getTime()/1e3),$.ajax({type:"POST",data:JSON.stringify(t),url:"/totes/createtote",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){window.location.href="/"}).fail(function(e){alert("Something went wrong :(. Error: "+e.msg)})}}};$(document).ready(function(){void 0===$.cookie("likes")&&$.cookie("likes",""),$(document).hammer().on("tap","button.close.createpage, button.close.createpage span",function(){window.location.href="/"}),site.refreshTypeOnTotes(),$(window).resize(function(){resizeHelper()}),$(window).scroll(function(){scrollHelper()}),$(document).hammer().on("tap",".create button, .create button span",function(){window.location.href="/totes/newtote"}),ga("send","pageview")});