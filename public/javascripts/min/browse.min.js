var browse={toteBags:[],sort:function(e,t){browse.toteBags=_.sortBy(browse.toteBags,e),"desc"===t&&(browse.toteBags=browse.toteBags.reverse()),browse.animateOut(function(){$(".browse-tote-wrap").empty(),browse.buildBagGrid()})},gridOrderHelper:function(e){var t=$(".tote-grid-element").width(),r=Math.round($(window).width()/t),o=e%(2*r);return r>o?e:e+(r-1-2*(o-r))},animateIn:function(e,t){e=e||0,browse.animateInHelper(e,t)},animateInHelper:function(e,t){var r=$(".tote-grid-element").length;return e>=r?void setTimeout(function(){t&&void 0!==t&&t()},20*e):void setTimeout(function(){var r=browse.gridOrderHelper(e);0===$(".tote-grid-element").eq(r).length&&(r=e),$(".tote-grid-element").eq(r).removeClass("start"),browse.animateInHelper(e+1,t)},20*e)},animateOut:function(e){var t=$(".tote-grid-element").length;browse.animateOutHelper(t-1,e)},animateOutHelper:function(e,t){var r=$(".tote-grid-element").length;return 0>e?void setTimeout(function(){t&&void 0!==t&&t()},20*r):void setTimeout(function(){var r=browse.gridOrderHelper(e);$(".tote-grid-element").eq(r).addClass("start"),browse.animateOutHelper(e-1,t)},10*(r-e))},loadBags:function(){$.getJSON("/totes",function(e){browse.toteBags=_.sortBy(e,function(e){return e.timestamp}),browse.toteBags=browse.toteBags.reverse(),browse.buildBagGrid()})},buildBagGrid:function(){_.each(browse.toteBags,function(e){"string"==typeof e.textfields&&(e.textfields=JSON.parse(e.textfields));var t={bags:[e]};$.get("/templates/_bag.html",function(r){{var o=Handlebars.compile(r),a=o(t);$("<div />",{id:"tote-"+t._id,"class":"tote-grid-element start",html:"<div class='heart-wrap'><div class='heart-circle'></div><div class='heart'><div class='inner-heart grey'></div><div class='inner-heart white'></div></div></div>"+a}).appendTo(".browse-page.content .browse-tote-wrap")}e==browse.toteBags[browse.toteBags.length-1]&&(site.refreshTypeOnTotes(),browse.animateIn())})})}},gridElement={data:null};$(document).ready(function(){browse.loadBags(),$(document).hammer().on("tap",".sort ul li",function(){var e=$(this).attr("data-attr"),t=$(this).attr("data-dir");browse.sort(e,t)}),$(document).hammer().on("tap",".heart-wrap",function(e){e.preventDefault(),e.stopPropagation(),$(this).toggleClass("favorited")})});