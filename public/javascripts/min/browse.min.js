function loadBags(){$.getJSON("/totes",function(e){toteBags=sortByKey(e,"timestamp","desc"),totalPages=Math.ceil(toteBags.length/loadChunk),buildBagGrid(e)})}function buildBagGrid(e){if(totalPages>currPage){currPage++;var t=(currPage-1)*loadChunk,a=currPage*loadChunk;a>e.length&&(a=e.length);for(var r=t;a>r;r++){var o=e[r],n=$("<div/>",{id:"tote-"+o.bagNum,"class":"tote-grid-element tote start",html:"<div class='heart-wrap'><div class='heart-circle'></div><div class='heart'><div class='inner-heart grey'></div><div class='inner-heart white'></div></div></div><div class='grid-wrap'><div class='actual-tote "+o.size+" "+o.color+"'><div class='text-wrap'>"+o.text+"</div><div class='shadow-blur'><div class='tote-shadow'></div></div></div></div>"});n.find(".text-wrap").css("text-align",o.justification),n.find(".text-wrap").css("font-size",o.fontSize+"em"),n.find(".text-wrap").css("letter-spacing",o.kerning+"em"),n.find(".text-wrap").css("line-height",o.leading+"em");var s=Number(o.yAxis)*multiplier/maxColumns;n.find(".text-wrap").css("transform","translateY("+s+"px)"),n.find(".text-wrap").css("-webkit-transform","translateY("+s+"px)"),n.find(".text-wrap").css("-moz-transform","translateY("+s+"px)"),n.appendTo(".browse-tote-wrap")}if(resizeHandler(),checkFavorites(),$(".overlay-tote").length>0){$(".tote-grid-element, .featured-carousel").addClass("no-transition"),$(".tote-grid-element").removeClass("start"),$(".featured-carousel").addClass("on");var i=$(".overlay-tote").attr("id").substr(14);$("#tote-"+i).hasClass("overlayed")||($("#tote-"+i).addClass("overlayed"),checkArrows()),setTimeout(function(){$(".featured-carousel, .tote-grid-element").removeClass("no-transition")},300)}else animateIn(t,$.noop)}}function gridOrderHelper(e){var t=e%(2*currColumns);return currColumns>t?e:e+(currColumns-1-2*(t-currColumns))}function animateIn(e,t){e=e||0,animateInHelper(e,t)}function animateInHelper(e,t){var a=$(".tote-grid-element").length;return e>=a?void setTimeout(function(){t&&void 0!=t&&t()},20*e):void setTimeout(function(){var a=gridOrderHelper(e);0==$(".tote-grid-element").eq(a).length&&(a=e),$(".tote-grid-element").eq(a).removeClass("start"),animateInHelper(e+1,t)},20*e)}function animateOut(e){var t=$(".tote-grid-element").length;animateOutHelper(t-1,e)}function animateOutHelper(e,t){var a=$(".tote-grid-element").length;return 0>e?void setTimeout(function(){t&&void 0!=t&&t()},20*a):void setTimeout(function(){var a=gridOrderHelper(e);$(".tote-grid-element").eq(a).addClass("start"),animateOutHelper(e-1,t)},10*(a-e))}function resizeHandler(){var e=$(window).width(),t=4;if(t=oneColumnMax>=e?1:e>oneColumnMax&&twoColumnMax>=e?2:e>twoColumnMax&&threeColumnMax>=e?3:4,currColumns!==t){var a=t/maxColumns;$.each(toteBags,function(e,r){var o=Number(r.yAxis)*a*multiplier/t,n=$("#tote-"+r.bagNum);n.find(".text-wrap").css("transform","translateY("+o+"px)"),n.find(".text-wrap").css("-webkit-transform","translateY("+o+"px)"),n.find(".text-wrap").css("-moz-transform","translateY("+o+"px)")}),currColumns=t}}function checkFavorites(){$.each(toteBags,function(e,t){hasLike(t._id)&&$("#tote-"+t.bagNum+" .heart-wrap").addClass("favorited")})}function returnToteByIndex(e){for(var t=0,a=toteBags.length;a>t;t++)if(toteBags[t].bagNum==e)return toteBags[t]}var multiplier=1.1,maxColumns=4,currColumns=4,oneColumnMax=800,twoColumnMax=1150,threeColumnMax=1500,toteBags=[],loadChunk=3*currColumns,currPage=0,totalPages;$(document).ready(function(){loadBags(),$(window).resize(function(){resizeHandler()}),$(document).hammer().on("tap",".sort .selected-sort",function(){$(this).find("ul").toggleClass("open")}),$(document).hammer().on("tap","li.item",function(){var e=$(this),t=e.html();$(".sort .selected-sort .name").html()!==t&&animateOut(function(){window.scrollTo(0,0),$(".tote-grid-element").remove();var a=e.attr("data-attr"),r=e.attr("data-dir");$(".sort .selected-sort .name").html(t);var o=sortByKey(toteBags,a,r);currPage=0,buildBagGrid(o)})}),$(window).scroll(function(){var e=$(window).scrollTop(),t=e+$(window).height(),a=$(".browse-tote-wrap").height(),r=$(".tote-grid-element").height(),o=a-r;totalPages>currPage&&t>o&&buildBagGrid(toteBags)}),$(document).hammer().on("tap",".tote-grid-element",function(){var e=Number($(this).attr("id").substr(5));$(this).addClass("overlayed");var t=returnToteByIndex(e);showTote(e,t,function(){$(".featured-carousel").addClass("on"),checkArrows()})}),$(document).hammer().on("tap",".close-overlay",function(){hideTote()}),$(document).hammer().on("tap",".arrow.left",function(){prevTote()}),$(document).hammer().on("tap",".arrow.right",function(){nextTote()}),$(document).hammer().on("tap",".heart-wrap",function(e){e.stopPropagation();var t,a=$(this).parents(".tote");t=Number(a.hasClass("featured-carousel")?$(".overlay-tote").attr("id").substr(14):a.attr("id").substr(5));var r=returnToteByIndex(t),o=r._id,n=$(this).hasClass("favorited");r.likes=n?Number(r.likes)-1:Number(r.likes)+1;var s=jQuery.extend(!0,{},r);delete s._id,$.ajax({type:"PUT",data:s,url:"/totes/updatetote/"+o}).done(function(e){""===e.msg?n?(removeLike(o),$("#tote-"+r.bagNum+" .heart-wrap").removeClass("favorited"),$(".featured-carousel .heart-wrap").removeClass("favorited")):(addLike(o),$("#tote-"+r.bagNum+" .heart-wrap").addClass("favorited"),$(".featured-carousel .heart-wrap").addClass("favorited")):console.log("Error: "+e.msg)})})});