function loadBags(){$.getJSON("/totes",function(t){toteBags=sortByKey(t,"timestamp","desc"),totalPages=Math.ceil(toteBags.length/loadChunk),buildBagGrid(t)})}function buildBagGrid(t){if(totalPages>currPage){currPage++;var e=(currPage-1)*loadChunk,a=currPage*loadChunk;a>t.length&&(a=t.length);for(var r=e;a>r;r++){var o=t[r],n=$("<div/>",{id:"tote-"+o.bagNum,"class":"tote-grid-element tote start",html:"<div class='heart-wrap'><div class='heart-circle'></div><div class='heart'><div class='inner-heart grey'></div><div class='inner-heart white'></div></div></div><div class='grid-wrap'><div class='actual-tote "+o.size+" "+o.color+"'><div class='text-wrap'>"+o.text+"</div><div class='shadow-blur'><div class='tote-shadow'></div></div></div></div>"});n.find(".text-wrap").css("text-align",o.justification),n.find(".text-wrap").css("font-size",o.fontSize+"em"),n.find(".text-wrap").css("letter-spacing",o.kerning+"em"),n.find(".text-wrap").css("line-height",o.leading+"em");var s=Number(o.yAxis)*multiplier/maxColumns;n.find(".text-wrap").css("transform","translateY("+s+"px)"),n.find(".text-wrap").css("-webkit-transform","translateY("+s+"px)"),n.find(".text-wrap").css("-moz-transform","translateY("+s+"px)"),n.appendTo(".browse-tote-wrap")}if(resizeHandler(),checkFavorites(),$(".overlay-tote").length>0){$(".tote-grid-element, .featured-carousel").addClass("no-transition"),$(".tote-grid-element").removeClass("start"),$(".featured-carousel").addClass("on");var i=$(".overlay-tote").attr("id").substr(14);$("#tote-"+i).hasClass("overlayed")||($("#tote-"+i).addClass("overlayed"),checkArrows()),setTimeout(function(){$(".featured-carousel, .tote-grid-element").removeClass("no-transition")},300)}else animateIn(e,$.noop)}}function gridOrderHelper(t){var e=t%(2*currColumns);return currColumns>e?t:t+(currColumns-1-2*(e-currColumns))}function animateIn(t,e){t=t||0,animateInHelper(t,e)}function animateInHelper(t,e){var a=$(".tote-grid-element").length;return t>a?void setTimeout(function(){e&&void 0!=e&&e()},20*t):void setTimeout(function(){var a=gridOrderHelper(t);$(".tote-grid-element").eq(a).removeClass("start"),animateInHelper(t+1,e)},20*t)}function animateOut(t){var e=$(".tote-grid-element").length;animateOutHelper(e-1,t)}function animateOutHelper(t,e){var a=$(".tote-grid-element").length;return 0>t?void setTimeout(function(){e&&void 0!=e&&e()},20*a):void setTimeout(function(){var a=gridOrderHelper(t);$(".tote-grid-element").eq(a).addClass("start"),animateOutHelper(t-1,e)},10*(a-t))}function resizeHandler(){var t=$(window).width(),e=4;if(e=oneColumnMax>=t?1:t>oneColumnMax&&twoColumnMax>=t?2:t>twoColumnMax&&threeColumnMax>=t?3:4,currColumns!==e){var a=e/maxColumns;$.each(toteBags,function(t,r){var o=Number(r.yAxis)*a*multiplier/e,n=$("#tote-"+r.bagNum);n.find(".text-wrap").css("transform","translateY("+o+"px)"),n.find(".text-wrap").css("-webkit-transform","translateY("+o+"px)"),n.find(".text-wrap").css("-moz-transform","translateY("+o+"px)")}),currColumns=e}}function checkFavorites(){$.each(toteBags,function(t,e){hasLike(e._id)&&$("#tote-"+e.bagNum+" .heart-wrap").addClass("favorited")})}function returnToteByIndex(t){for(var e=0,a=toteBags.length;a>e;e++)if(toteBags[e].bagNum==t)return toteBags[e]}var multiplier=1.1,maxColumns=4,currColumns=4,oneColumnMax=800,twoColumnMax=1150,threeColumnMax=1500,toteBags=[],loadChunk=3*currColumns,currPage=0,totalPages;$(document).ready(function(){loadBags(),$(window).resize(function(){resizeHandler()}),$(document).hammer().on("tap",".sort .selected-sort",function(){$(this).find("ul").toggleClass("open")}),$(document).hammer().on("tap","li.item",function(){var t=$(this),e=t.html();$(".sort .selected-sort .name").html()!==e&&animateOut(function(){window.scrollTo(0,0),$(".tote-grid-element").remove();var a=t.attr("data-attr"),r=t.attr("data-dir");$(".sort .selected-sort .name").html(e);var o=sortByKey(toteBags,a,r);currPage=0,buildBagGrid(o)})}),$(window).scroll(function(){var t=$(window).scrollTop(),e=t+$(window).height(),a=$(document).height(),r=$(".tote-grid-element").height(),o=a-r;totalPages>currPage&&e>o&&buildBagGrid(toteBags)}),$(document).hammer().on("tap",".tote-grid-element",function(){var t=Number($(this).attr("id").substr(5));$(this).addClass("overlayed");var e=returnToteByIndex(t);showTote(t,e,function(){$(".featured-carousel").addClass("on"),checkArrows()})}),$(document).hammer().on("tap",".close-overlay",function(){hideTote()}),$(document).hammer().on("tap",".arrow.left",function(){prevTote()}),$(document).hammer().on("tap",".arrow.right",function(){nextTote()}),$(document).hammer().on("tap",".heart-wrap",function(t){t.stopPropagation();var e,a=$(this).parents(".tote");e=Number(a.hasClass("featured-carousel")?$(".overlay-tote").attr("id").substr(14):a.attr("id").substr(5));var r=returnToteByIndex(e),o=r._id,n=$(this).hasClass("favorited");r.likes=n?Number(r.likes)-1:Number(r.likes)+1;var s=jQuery.extend(!0,{},r);delete s._id,$.ajax({type:"PUT",data:s,url:"/totes/updatetote/"+o}).done(function(t){""===t.msg?n?(removeLike(o),$("#tote-"+r.bagNum+" .heart-wrap").removeClass("favorited"),$(".featured-carousel .heart-wrap").removeClass("favorited")):(addLike(o),$("#tote-"+r.bagNum+" .heart-wrap").addClass("favorited"),$(".featured-carousel .heart-wrap").addClass("favorited")):console.log("Error: "+t.msg)})})});